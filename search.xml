<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>RLHF çš„ä¸‰é˜¶æ®µæµç¨‹</title>
      <link href="/2026/02/23/RLHF%20%E7%9A%84%E4%B8%89%E9%98%B6%E6%AE%B5%E6%B5%81%E7%A8%8B/"/>
      <url>/2026/02/23/RLHF%20%E7%9A%84%E4%B8%89%E9%98%B6%E6%AE%B5%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1>1</h1><h2 id="åŸºç¡€çŸ¥è¯†5">åŸºç¡€çŸ¥è¯†5</h2><h3 id="RLHF-çš„ä¸‰é˜¶æ®µæµç¨‹">RLHF çš„ä¸‰é˜¶æ®µæµç¨‹</h3><p>RLHFï¼ˆReinforcement Learning from Human Feedbackï¼‰é€šå¸¸åŒ…å«ä¸‰ä¸ªä¸»è¦é˜¶æ®µï¼š</p><p><strong>ç›‘ç£å¾®è°ƒï¼ˆSFTï¼‰â†’ åå¥½é‡‡æ · + å¥–åŠ±æ¨¡å‹å­¦ä¹  â†’ å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–ï¼ˆRLï¼‰</strong></p><p>ç®€å•å¯ä»¥ç†è§£ä¸ºï¼šå…ˆå­¦&quot;æ€ä¹ˆè¯´è¯&quot;ï¼Œå†å­¦&quot;ä»€ä¹ˆè¯æ›´å¥½&quot;ï¼Œæœ€åé€¼æ¨¡å‹å¤šè¯´&quot;å¥½è¯&quot;</p><h4 id="é˜¶æ®µä¸€ï¼šSFTï¼ˆSupervised-Fine-Tuningï¼‰">é˜¶æ®µä¸€ï¼šSFTï¼ˆSupervised Fine-Tuningï¼‰</h4><p>RLHF é€šå¸¸ä»å¯¹ä¸€ä¸ªé¢„è®­ç»ƒè¯­è¨€æ¨¡å‹è¿›è¡Œç›‘ç£å¾®è°ƒå¼€å§‹ï¼Œä½¿ç”¨é«˜è´¨é‡çš„äººå·¥æ•°æ®ï¼ˆå¦‚å¯¹è¯ã€æ‘˜è¦ç­‰ï¼‰ï¼Œå¾—åˆ°ä¸€ä¸ªæ¨¡å‹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\pi_{SFT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ã€‚</p><p><strong>æ•°æ®å½¢å¼</strong>: (\text{prompt} \, x, \text{é«˜è´¨é‡å›ç­”} \, y)</p><p><strong>æŸå¤±å‡½æ•°</strong>: æ ‡å‡†çš„ç›‘ç£å­¦ä¹ æŸå¤±å‡½æ•°</p>\begin{equation}\label{eq:sft_loss}\max_{\theta} \sum_{(x,y) \in D} \log \pi_\theta(y|x)\end{equation}<ul><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mi>Î¸</mi></msub></mrow><annotation encoding="application/x-tex">\pi_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼šç­–ç•¥æ¨¡å‹çš„å‚æ•°åŒ–å½¢å¼</li><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span></span>ï¼šç›‘ç£å¾®è°ƒæ•°æ®é›†</li><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span></span></span></span>ï¼šè¾“å…¥æç¤º</li><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span>ï¼šç›®æ ‡å›ç­”</li></ul><p><strong>ç›®æ ‡</strong>: è®©æ¨¡å‹å­¦ä¼šåŸºæœ¬çš„å¯¹è¯èƒ½åŠ›å’Œä»»åŠ¡å®Œæˆèƒ½åŠ›ï¼Œå³&quot;æ€ä¹ˆè¯´è¯&quot;</p><h4 id="é˜¶æ®µäºŒï¼šå¥–åŠ±æ¨¡å‹ï¼ˆReward-Modelingï¼‰">é˜¶æ®µäºŒï¼šå¥–åŠ±æ¨¡å‹ï¼ˆReward Modelingï¼‰</h4><p>ä½¿ç”¨ SFT æ¨¡å‹ï¼Œå¯¹åŒä¸€ä¸ª prompt <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span></span></span></span> é‡‡æ ·ä¸¤ä¸ªå›ç­”ï¼š</p>\begin{equation}\label{eq:sample}y_1, y_2 \sim \pi_{SFT}(y|x)\end{equation}<p>äº¤ç»™äººç±»æ ‡æ³¨è€…ï¼Œè®©ä»–ä»¬é€‰æ›´å¥½çš„ä¸€ä¸ªï¼š</p>\begin{equation}\label{eq:preference}y_w \succ y_l \mid x\end{equation}<ul><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">y_w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼šwinner,preferredï¼ˆèµ¢å®¶ï¼‰</li><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>l</mi></msub></mrow><annotation encoding="application/x-tex">y_l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼šloser,rejectedï¼ˆè¾“å®¶ï¼‰</li></ul><p><strong>æ½œåœ¨å¥–åŠ±å‡½æ•°å‡è®¾</strong>: å‡è®¾äººç±»åå¥½æ˜¯ç”±ä¸€ä¸ªæœªçŸ¥çš„çœŸå®å¥–åŠ±å‡½æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>r</mi><mo>âˆ—</mo></msup><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">r^*(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">âˆ—</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> ç”Ÿæˆçš„ã€‚æˆ‘ä»¬å¹¶ä¸çŸ¥é“å®ƒï¼Œä½†å‡è®¾å®ƒå­˜åœ¨ã€‚</p><p><strong>åå¥½æ¨¡å‹</strong>:</p>\begin{equation}\label{eq:bt_model}p^*(y_1 > y_2 | x) = \frac{\exp(r^*(x, y_1))}{\exp(r^*(x, y_1)) + \exp(r^*(x, y_2))}\end{equation}<p><strong>æ•°æ®é›†å½¢å¼</strong>:</p>\begin{equation}\label{eq:dataset}D = \{(x^{(i)}, y_w^{(i)}, y_l^{(i)})\}_{i=1}^N\end{equation}<p><strong>æŸå¤±å‡½æ•°</strong>:</p>\begin{equation}\label{eq:rm_loss}\mathcal{L}_\text{R}(r_\phi, \mathcal{D}) = -\mathbb{E}_{(x, y_w, y_l) \sim \mathcal{D}} \left[ \log \sigma (r_\phi(x, y_w) - r_\phi(x, y_l)) \right]\end{equation}<hr><h5 id="è¡¥å……è§£é‡Š">è¡¥å……è§£é‡Š</h5><p>BT æ¨¡å‹ï¼š</p><p>Bradley-Terry æ¨¡å‹æ˜¯ä¸€ä¸ªç”¨äº<strong>æˆå¯¹æ¯”è¾ƒ</strong>çš„æ¦‚ç‡æ¨¡å‹</p><p><strong>æ ¸å¿ƒæ€æƒ³</strong>:</p><ul><li>æ¯ä¸ªå¯¹è±¡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> æœ‰ä¸€ä¸ªéšè—çš„&quot;å®åŠ›å€¼&quot;å‚æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î»</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\lambda_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">Î»</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span></li><li>å½“ä¸¤ä¸ªå¯¹è±¡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span></span> æ¯”è¾ƒæ—¶ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> æˆ˜èƒœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span></span> çš„æ¦‚ç‡ä¸ºï¼š</li></ul>\begin{equation}\label{eq:bt_prob}P(i \succ j) = \frac{\lambda_i}{\lambda_i + \lambda_j}\end{equation}<p><strong>åœ¨ DPO ä¸­çš„åº”ç”¨</strong>:</p><ul><li>å°†å¥–åŠ±å‡½æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">r(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> çœ‹ä½œ&quot;å®åŠ›å€¼&quot;</li><li>äººç±»åå¥½ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>w</mi></msub><mo>â‰»</mo><msub><mi>y</mi><mi>l</mi></msub></mrow><annotation encoding="application/x-tex">y_w \succ y_l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.5391em;"></span><span class="strut bottom" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mrel">â‰»</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> å°±æ˜¯&quot;æ¯”è¾ƒç»“æœ&quot;</li><li>é€šè¿‡ BT æ¨¡å‹å»ºç«‹å¥–åŠ±ä¸åå¥½çš„æ¡¥æ¢</li></ul><p>ä¸ºä»€ä¹ˆä¸ç”¨ã€Œè°åˆ†æ•°å¤§å°±é€‰è°ã€ï¼Ÿ</p><p>å¦‚æœç›´æ¥è§„å®š: $$ y_1 \succ y_2 \iff r^<em>(x,y_1) &gt; r^</em>(x,y_2) $$<br>é‚£é—®é¢˜æ˜¯: äººç±»åˆ¤æ–­æœ‰å™ªå£°ï¼ŒåŒä¸€ä¸ªäººã€åŒä¸€ä¸ªé—®é¢˜ï¼Œä¸ä¸€å®šæ¯æ¬¡é€‰åŒæ ·çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸å»ºæ¨¡æˆç¡®å®šæ€§è§„åˆ™ï¼Œè€Œæ˜¯: æ¦‚ç‡æ¨¡å‹</p><p>æŠŠå…¬å¼ \eqref{eq:bt_model} æ”¹å†™ä¸€ä¸‹ï¼š</p>\begin{equation}\label{eq:bt_sigmoid}p^*(y_1 \succ y_2 \mid x) = \frac{1}{1 + e^{-(r^*(x,y_1) - r^*(x,y_2))}}\end{equation}<p>è¿™å°±æ˜¯ç†Ÿæ‚‰çš„ Sigmoid å‡½æ•°:</p>\begin{equation}\label{eq:sigmoid}\sigma(z) = \frac{1}{1 + e^{-z}}\end{equation}<p>äºæ˜¯:</p>\begin{equation}\label{eq:bt_final}p^*(y_1 \succ y_2 \mid x) = \sigma(r^*(x,y_1) - r^*(x,y_2))\end{equation}<p>å› ä¸ºçœŸå®æ•°æ®é‡Œäººç¡®å®é€‰æ‹©äº† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">y_w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼Œæ‰€ä»¥è¯¥äº‹ä»¶çš„æ¦‚ç‡æ˜¯ä¸Šå¼ï¼Œå¯¹æ•°ä¼¼ç„¶æ˜¯ï¼š</p>\begin{equation}\label{eq:log_likelihood}\log p_\theta(y_w \succ y_l \mid x) = \log \sigma(r_\theta(x,y_w) - r_\theta(x,y_l))\end{equation}<p>æœ€å¤§åŒ–æ‰€æœ‰æ ·æœ¬çš„å¯¹æ•°ä¼¼ç„¶ï¼š</p>\begin{equation}\label{eq:max_likelihood}\max_\theta \sum_{i=1}^N \log \sigma(r_\theta(x^{(i)}, y_w^{(i)}) - r_\theta(x^{(i)}, y_l^{(i)}))\end{equation}<p>æ„æ€æ˜¯: å¯¹æ¯ä¸€æ¡æ•°æ®ï¼Œéƒ½ç®—ä¸€æ¬¡&quot;æ¨¡å‹è®¤ä¸ºäººç±»ä¼šé€‰èµ¢å®¶çš„æ¦‚ç‡çš„å¯¹æ•°&quot;ï¼Œç„¶åæŠŠå®ƒä»¬åŠ èµ·æ¥ï¼Œè®©è¿™ä¸ªæ€»å’Œå°½å¯èƒ½å¤§ã€‚å¯¹æ•°æŠŠâ€œè¿ä¹˜â€å˜æˆâ€œè¿åŠ â€ï¼Œæœ€ä¼˜è§£ä¸å˜ï¼ˆå¯¹æ•°æ˜¯å•è°ƒé€’å¢å‡½æ•°ï¼‰</p><p>ç­‰ä»·åœ°ï¼Œæœ€å°åŒ–è´Ÿå¯¹æ•°ä¼¼ç„¶ï¼ˆLikelihoodï¼‰ï¼š</p>\begin{equation}\label{eq:negative_likelihood}L_R = -\mathbb{E}_{(x,y_w,y_l) \sim D} [\log \sigma(r_\theta(x,y_w) - r_\theta(x,y_l))]\end{equation}<p>è¿™æ­£æ˜¯å…¬å¼ \eqref{eq:rm_loss}ã€‚æ„æ€æ˜¯: å¯¹æ•°æ®é›†é‡Œçš„æ ·æœ¬å–å¹³å‡ï¼Œç„¶åå¯¹&quot;å¯¹æ•°æ¦‚ç‡&quot;å–è´Ÿå·ï¼Œè®©è¿™ä¸ªå€¼å°½å¯èƒ½å°ã€‚</p><p>å¯¹ä¸€ä¸ªæœ‰é™æ•°æ®é›† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mo>=</mo><mo>{</mo><msub><mi>z</mi><mn>1</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>z</mi><mi>N</mi></msub><mo>}</mo></mrow><annotation encoding="application/x-tex">D = \{z_1, ..., z_N\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mrel">=</span><span class="mopen">{</span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.04398em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mpunct">,</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.04398em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mclose">}</span></span></span></span>ï¼Œå¦‚æœä½ å‡åŒ€éšæœºä»ä¸­æŠ½ä¸€ä¸ªæ ·æœ¬ï¼Œé‚£ä¹ˆï¼š</p>\begin{equation}\label{eq:expectation}\mathbb{E}_{z \sim D} [f(z)] = \frac{1}{N} \sum_{i=1}^N f(z_i)\end{equation}<p>ğŸ‘‰ æœŸæœ› = å¹³å‡å€¼</p><p>ä»¤ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>y</mi><mi>w</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>l</mi></msub><mo>)</mo><mo>=</mo><mi>log</mi><mi>Ïƒ</mi><mo>(</mo><msub><mi>r</mi><mi>Î¸</mi></msub><mo>(</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>y</mi><mi>w</mi></msub><mo>)</mo><mo>âˆ’</mo><msub><mi>r</mi><mi>Î¸</mi></msub><mo>(</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>y</mi><mi>l</mi></msub><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">f(x,y_w,y_l) = \log\sigma(r_\theta(x,y_w)-r_\theta(x,y_l))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mord mathit" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mclose">)</span><span class="mbin">âˆ’</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span> é‚£ä¹ˆï¼š</p>\begin{equation}\label{eq:expectation_rm}\mathbb{E}_{(x,y_w,y_l) \sim D} [f] = \frac{1}{N} \sum_{i=1}^N \log \sigma(r_\theta(x^{(i)}, y_w^{(i)}) - r_\theta(x^{(i)}, y_l^{(i)}))\end{equation}<p>å› ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\sum_{i=1}^N f_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8423309999999999em;"></span><span class="strut bottom" style="height:1.142341em;vertical-align:-0.30001em;"></span><span class="base textstyle uncramped"><span class="mop"><span class="op-symbol small-op mop" style="top:-0.0000050000000000050004em;">âˆ‘</span><span class="vlist"><span style="top:0.30001em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.364em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.10764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mi>N</mi></mrow></mfrac><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\frac{1}{N} \sum_{i=1}^N f_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.845108em;"></span><span class="strut bottom" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mop"><span class="op-symbol small-op mop" style="top:-0.0000050000000000050004em;">âˆ‘</span><span class="vlist"><span style="top:0.30001em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.364em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.10764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> åªå·®ä¸€ä¸ªå¸¸æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mi>N</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{N}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.845108em;"></span><span class="strut bottom" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span>ã€‚è€Œåœ¨ä¼˜åŒ–ä¸­: ä¹˜ä»¥ä¸€ä¸ªæ­£çš„å¸¸æ•°ï¼Œä¸ä¼šæ”¹å˜æœ€ä¼˜è§£çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´:</p>\begin{equation}\label{eq:argmax_equiv}\arg\max_\theta \sum_{i=1}^N f_i = \arg\max_\theta \frac{1}{N} \sum_{i=1}^N f_i\end{equation}<p>åŸç›®æ ‡ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>max</mi><mi>Î¸</mi></msub><msub><mrow><mi mathvariant="double-struck">E</mi></mrow><mi>D</mi></msub><mo>[</mo><mi>log</mi><mi>Ïƒ</mi><mo>(</mo><mo>â‹…</mo><mo>)</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">\max_\theta \mathbb{E}_D [\log \sigma(\cdot)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mop"><span class="mop">max</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class=""><span class="mord textstyle uncramped"><span class="mord mathbb">E</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">[</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mord mathit" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord">â‹…</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span></p><p>ç­‰ä»·äºï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>min</mi><mi>Î¸</mi></msub><mo>âˆ’</mo><msub><mrow><mi mathvariant="double-struck">E</mi></mrow><mi>D</mi></msub><mo>[</mo><mi>log</mi><mi>Ïƒ</mi><mo>(</mo><mo>â‹…</mo><mo>)</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">\min_\theta -\mathbb{E}_D [\log \sigma(\cdot)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mop"><span class="mop">min</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord">âˆ’</span><span class=""><span class="mord textstyle uncramped"><span class="mord mathbb">E</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">[</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mord mathit" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord">â‹…</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span></p><p>äºæ˜¯å®šä¹‰ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>R</mi></msub><mo>=</mo><mo>âˆ’</mo><msub><mrow><mi mathvariant="double-struck">E</mi></mrow><mi>D</mi></msub><mo>[</mo><mi>log</mi><mi>Ïƒ</mi><mo>(</mo><mo>â‹…</mo><mo>)</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">L_R = -\mathbb{E}_D [\log \sigma(\cdot)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mrel">=</span><span class="mord">âˆ’</span><span class=""><span class="mord textstyle uncramped"><span class="mord mathbb">E</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">[</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mord mathit" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord">â‹…</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span></p><p><strong>ä¸ºä»€ä¹ˆæœºå™¨å­¦ä¹ é‡Œ&quot;æ€»æ˜¯æœ€å°åŒ–&quot;ï¼Ÿ</strong></p><p>å› ä¸ºæ¢¯åº¦ä¸‹é™ï¼ˆGradient Descentï¼‰é»˜è®¤æ˜¯ minimize lossï¼Œæ‰€ä»¥å¤§å®¶ä¹ æƒ¯ï¼šæŠŠ&quot;æƒ³æœ€å¤§åŒ–çš„ç›®æ ‡&quot;ï¼Œå†™æˆ&quot;è¦æœ€å°åŒ–çš„æŸå¤±&quot;ã€‚</p><hr><h4 id="é˜¶æ®µä¸‰ï¼šRL-å¾®è°ƒ">é˜¶æ®µä¸‰ï¼šRL å¾®è°ƒ</h4><p><strong>RL ç›®æ ‡å‡½æ•°ï¼ˆæ ¸å¿ƒï¼‰</strong>ï¼š</p>\begin{equation}\label{eq:rl_objective}\max_{\pi_\theta} \mathbb{E}_{x \sim \mathcal{D}, y \sim \pi_\theta(y|x)} \left[ r_\phi(x, y) - \beta D_{\text{KL}} \left[ \pi_\theta(y|x) \middle\| \pi_{\text{ref}}(y|x) \right] \right]\end{equation}<hr><h5 id="è¡¥å……è§£é‡Š-2">è¡¥å……è§£é‡Š</h5><p>ä¸€å¥è¯è§£é‡Šï¼šğŸ‘‰ è®©æ¨¡å‹ç”Ÿæˆ å¥–åŠ±é«˜çš„å›ç­” ğŸ‘‰ ä½†ä¸èƒ½åç¦»åŸå§‹ SFT æ¨¡å‹å¤ªè¿œ</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mrow><mi>r</mi><mi>e</mi><mi>f</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\pi_{ref}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼ˆå³åˆå§‹æ¨¡å‹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\pi_{SFT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼‰å®è·µä¸­ï¼Œè¯­è¨€æ¨¡å‹ç­–ç•¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mi>Î¸</mi></msub></mrow><annotation encoding="application/x-tex">\pi_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> ä¹Ÿè¢«åˆå§‹åŒ–ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\pi_{SFT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ã€‚</p><ul><li><strong>åˆå§‹çŠ¶æ€</strong>ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mi>Î¸</mi></msub><mo>=</mo><msub><mi>Ï€</mi><mrow><mi>r</mi><mi>e</mi><mi>f</mi></mrow></msub><mo>=</mo><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\pi_\theta = \pi_{ref} = \pi_{SFT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span></li><li><strong>è®­ç»ƒç›®æ ‡</strong>ï¼šåœ¨ä¿æŒä¸åŸå§‹ SFT æ¨¡å‹æ¥è¿‘çš„å‰æä¸‹ï¼Œä¼˜åŒ–å¥–åŠ±</li><li><strong>KL çº¦æŸä½œç”¨</strong>ï¼šç¡®ä¿æ¨¡å‹ä¸ä¼šåç¦»åˆå§‹èƒ½åŠ›å¤ªè¿œ</li></ul><p><strong>KL çº¦æŸï¼š</strong></p><p>KL æ•£åº¦ï¼ˆKullback-Leibler æ•£åº¦ï¼‰è¡¡é‡ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„å·®å¼‚ï¼š</p>\begin{equation}\label{eq:kl_general}D_{\text{KL}}[P \| Q] = \sum_x P(x) \log \frac{P(x)}{Q(x)}\end{equation}\begin{equation}\label{eq:kl_policy}D_{\text{KL}}[\pi_\theta(y|x) \| \pi_{SFT}(y|x)] = \mathbb{E}_{y \sim \pi_\theta} \left[ \log \frac{\pi_\theta(y|x)}{\pi_{SFT}(y|x)} \right]\end{equation}<p>è¿™è¡¨ç¤ºï¼š</p><ul><li>å¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mi>Î¸</mi></msub></mrow><annotation encoding="application/x-tex">\pi_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\pi_{SFT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> ç›¸åŒï¼šKL = 0</li><li>å¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mi>Î¸</mi></msub></mrow><annotation encoding="application/x-tex">\pi_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> åç¦» <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\pi_{SFT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼šKL &gt; 0</li><li>ç›®æ ‡å‡½æ•°ä¸­çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>âˆ’</mo><mi>Î²</mi><mi>K</mi><mi>L</mi></mrow><annotation encoding="application/x-tex">-\beta KL</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord">âˆ’</span><span class="mord mathit" style="margin-right:0.05278em;">Î²</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathit">L</span></span></span></span> æƒ©ç½šåç¦»è¡Œä¸º</li></ul><p><strong>KL æ•£åº¦æ¨å¯¼è¿‡ç¨‹è¯¦è§£</strong></p><p><strong>KL æ•£åº¦çš„é€šç”¨å®šä¹‰ï¼ˆç¦»æ•£å‹ï¼‰</strong>:</p>\begin{equation}\label{eq:kl_discrete}D_{\text{KL}}[P \| Q] = \sum_i P(i) \log \frac{P(i)}{Q(i)}\end{equation}<p><strong>æœŸæœ›çš„å®šä¹‰</strong>:<br>å¯¹äºéšæœºå˜é‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Y</mi><mo>âˆ¼</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">Y \sim P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.22222em;">Y</span><span class="mrel">âˆ¼</span><span class="mord mathit" style="margin-right:0.13889em;">P</span></span></span></span>ï¼Œå‡½æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>Y</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">f(Y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span> çš„æœŸæœ›å®šä¹‰ä¸º:</p>\begin{equation}\label{eq:expectation_def}\mathbb{E}_{Y \sim P}[f(Y)] = \sum_{y \in \mathcal{Y}} P(y) f(y)\end{equation}<p><strong>è¿›è¡Œå˜é‡æ˜ å°„</strong></p><p>åœ¨ RLHF çš„è¯­å¢ƒä¸‹ï¼Œæˆ‘ä»¬è¦è®¡ç®—çš„æ˜¯ä¸¤ä¸ªæ¨¡å‹ç­–ç•¥ï¼ˆæ¦‚ç‡åˆ†å¸ƒï¼‰ä¹‹é—´çš„å·®å¼‚ï¼š</p><ul><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span></span></span></span>** (å½“å‰åˆ†å¸ƒ)**ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mi>Î¸</mi></msub><mo>(</mo><mi>y</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\pi_\theta(y|x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathrm">âˆ£</span><span class="mord mathit">x</span><span class="mclose">)</span></span></span></span> â€”â€” æ¨¡å‹å½“å‰æ­£åœ¨å­¦ä¹ çš„ç­–ç•¥</li><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">Q</span></span></span></span>** (å‚è€ƒåˆ†å¸ƒ)**ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub><mo>(</mo><mi>y</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\pi_{SFT}(y|x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathrm">âˆ£</span><span class="mord mathit">x</span><span class="mclose">)</span></span></span></span> â€”â€” åŸå§‹çš„ SFT ç­–ç•¥</li><li><strong>æ ·æœ¬ç©ºé—´</strong>ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span>ï¼ˆæ¨¡å‹ç”Ÿæˆçš„æ‰€æœ‰å¯èƒ½çš„å›ç­”åºåˆ—ï¼‰</li></ul><p>å°†è¿™äº›ä»£å…¥é€šç”¨å…¬å¼ï¼š</p>\begin{equation}\label{eq:kl_substitute}D_{\text{KL}}[\pi_\theta \| \pi_{SFT}] = \sum_y \pi_\theta(y|x) \log \frac{\pi_\theta(y|x)}{\pi_{SFT}(y|x)}\end{equation}<p><strong>è½¬åŒ–ä¸ºæœŸæœ›å½¢å¼</strong></p><p>å¤–å±‚åŠ æƒéƒ¨åˆ†ä¸è¢«åŠ æƒé¡¹æ”¹å†™å¦‚ä¸‹ï¼š</p>\sum_{y} \pi_\theta(y|x) (\cdots) \quad \text{å’Œ} \quad \log \frac{\pi_\theta(y|x)}{\pi_{SFT}(y|x)}<p>å‰è€…è¡¨ç¤º&quot;æŒ‰ç…§ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mi>Î¸</mi></msub><mo>(</mo><mi>y</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\pi_\theta(y|x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathrm">âˆ£</span><span class="mord mathit">x</span><span class="mclose">)</span></span></span></span> åˆ†å¸ƒåšåŠ æƒå¹³å‡&quot;ï¼Œåè€…æ˜¯è¢«å–æœŸæœ›çš„å¯¹è±¡ã€‚</p><p>å› æ­¤ï¼Œæ ¹æ® <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>âˆ‘</mo><mi>P</mi><mo>â‹…</mo><mi>f</mi><mo>=</mo><msub><mrow><mi mathvariant="double-struck">E</mi></mrow><mi>P</mi></msub><mo>[</mo><mi>f</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">\sum P \cdot f = \mathbb{E}_P[f]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="base textstyle uncramped"><span class="op-symbol small-op mop" style="top:-0.0000050000000000050004em;">âˆ‘</span><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mbin">â‹…</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mrel">=</span><span class=""><span class="mord textstyle uncramped"><span class="mord mathbb">E</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mclose">]</span></span></span></span> å¾—ï¼š</p>\begin{equation}\label{eq:kl_expectation_form}D_{\text{KL}}[\pi_\theta \| \pi_{SFT}] = \mathbb{E}_{y \sim \pi_\theta(y|x)} \left[ \log \frac{\pi_\theta(y|x)}{\pi_{SFT}(y|x)} \right].\end{equation}<p><strong>ä¸ºä»€ä¹ˆå®è·µä¸­è¦å†™æˆæœŸæœ›å½¢å¼ï¼Ÿ</strong></p><ol><li><strong>æ— æ³•å…¨é‡æ±‚å’Œ</strong>ï¼šè¯­è¨€æ¨¡å‹çš„è¾“å‡ºç©ºé—´å¤©æ–‡å·¨å¤§ï¼Œæ— æ³•æšä¸¾ $ y $ã€‚</li><li><strong>è’™ç‰¹å¡æ´›é‡‡æ ·</strong>ï¼šé€šè¿‡é‡‡æ · <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>âˆ¼</mo><msub><mi>Ï€</mi><mi>Î¸</mi></msub></mrow><annotation encoding="application/x-tex">y \sim \pi_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mrel">âˆ¼</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼Œè®¡ç®—</li></ol>\begin{equation}\label{eq:kl_sample}\log \pi_\theta(y|x) - \log \pi_{SFT}(y|x)\end{equation}<p>çš„å¹³å‡å€¼å³å¯è¿‘ä¼¼ KLã€‚<br>3. <strong>å¯¹é½ç›®æ ‡å‡½æ•°</strong>ï¼šåŸå§‹ RL ç›®æ ‡ä¹Ÿæ˜¯æœŸæœ›å½¢å¼ï¼Œå¯å†™æˆï¼š</p>\begin{equation}\label{eq:rl_aligned}\max_{\pi_\theta} \mathbb{E}_{y \sim \pi_\theta} \left[ r(x,y) - \beta \log \frac{\pi_\theta(y|x)}{\pi_{SFT}(y|x)} \right].\end{equation}<p>è¿™æ ·æ¯æ¬¡é‡‡æ ·å°±èƒ½åŒæ—¶æ›´æ–°å¥–åŠ±å’Œ KL æƒ©ç½šã€‚</p><p><strong>ä¸ºä»€ä¹ˆè¿™ä¸ªç›®æ ‡å‡½æ•°ä¸å¯å¯¼ï¼Ÿ</strong></p><p>è¯­è¨€æ¨¡å‹ç”Ÿæˆåºåˆ—æ˜¯ç¦»æ•£æ“ä½œï¼Œå¯¼è‡´ $ \mathbb{E}<em>{y \sim \pi</em>\theta(y|x)}[r(x,y)] $ æ— æ³•ç›´æ¥å¯¹ $ \theta $ æ±‚å¯¼ï¼Œåªèƒ½ç”¨ç­–ç•¥æ¢¯åº¦ï¼ˆREINFORCE/PPOï¼‰ã€‚</p><hr><p><strong>KL çº¦æŸå¦‚ä½•å˜æˆâ€œå¥–åŠ±â€ï¼Ÿ</strong></p><p>å…ˆæŠŠå…¬å¼ \eqref{eq:rl_objective} çš„ KL é¡¹å†™æˆ log-prob å½¢å¼ï¼š</p>\begin{equation}\label{eq:kl_logprob}D_{\text{KL}}(\pi_\theta \| \pi_{ref}) = \mathbb{E}_{y \sim \pi_\theta} \left[ \log \pi_\theta(y|x) - \log \pi_{ref}(y|x) \right].\end{equation}<p>ä»£å›ç›®æ ‡ï¼š</p>\begin{equation}\label{eq:objective_substituted}\mathbb{E}_{y \sim \pi_\theta} \left[ r_\phi(x, y) - \beta \left( \log \pi_\theta(y|x) - \log \pi_{ref}(y|x) \right) \right].\end{equation}<p>äºæ˜¯å¯ä»¥å®šä¹‰æ–°çš„å¥–åŠ±ï¼š</p>\begin{equation}\label{eq:new_reward}r(x, y) = r_\phi(x, y) - \beta \left( \log \pi_\theta(y|x) - \log \pi_{ref}(y|x) \right),\end{equation}<p>å³è®ºæ–‡ä¸­å¸¸è§çš„ï¼š</p>\begin{equation}\label{eq:new_reward_simplified}r(x, y) = r_\phi(x, y) - \left( \log \pi_\theta(y|x) - \log \pi_{ref}(y|x) \right),\end{equation}<p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î²</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05278em;">Î²</span></span></span></span> å¯è¢«å¸æ”¶åˆ°ç³»æ•°é‡Œã€‚</p><p><strong>è½¬æ¢åçš„ç®€åŒ–ç›®æ ‡</strong></p>\begin{equation}\label{eq:simplified_objective}\max_{\pi_\theta} \mathbb{E}_{x \sim \mathcal{D},\, y \sim \pi_\theta(y|x)} \left[ r(x, y) \right],\end{equation}<p>æ­¤æ—¶ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">r(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> å·²å« KL æƒ©ç½šï¼Œæˆä¸ºæ— çº¦æŸå¥–åŠ±æœ€å¤§åŒ–é—®é¢˜ã€‚</p><hr><h2 id="ç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDirect-Preference-Optimizationï¼‰">ç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDirect Preference Optimizationï¼‰</h2>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£ 88ï¼šåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</title>
      <link href="/2026/02/23/%E5%8A%9B%E6%89%A3/"/>
      <url>/2026/02/23/%E5%8A%9B%E6%89%A3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h2><p>ç»™å®šä¸¤ä¸ªæŒ‰éé€’å‡é¡ºåºæ’åˆ—çš„æ•´æ•°æ•°ç»„ <code>nums1</code> å’Œ <code>nums2</code>ï¼Œåˆ†åˆ«æœ‰é•¿åº¦ <code>m</code>ã€<code>n</code>ã€‚è¯·å°† <code>nums2</code> <strong>åŸåœ°</strong> åˆå¹¶åˆ° <code>nums1</code>ï¼Œä½¿ç»“æœä»ä¿æŒéé€’å‡é¡ºåºã€‚<code>nums1</code> çš„æ€»é•¿åº¦ä¸º <code>m + n</code>ï¼Œæœ«å°¾çš„ <code>n</code> ä¸ªä½ç½®åˆå§‹åŒ–ä¸º <code>0</code> ä½œä¸ºç¼“å†²åŒºã€‚</p><h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2><p>ä¸å…¶å…ˆæ‹¼æ¥å†æ•´ä½“æ’åºï¼Œä¸å¦‚åˆ©ç”¨â€œä¸¤æ•°ç»„å·²æ’åºâ€è¿™ä¸€ç‰¹æ€§ï¼Œä»å°¾éƒ¨å¼€å§‹å½’å¹¶ï¼š</p><ol><li>è®¾ <code>p1 = m - 1</code>ã€<code>p2 = n - 1</code> åˆ†åˆ«æŒ‡å‘ä¸¤ä¸ªæ•°ç»„çš„æœ€åä¸€ä¸ªæœ‰æ•ˆå…ƒç´ ï¼Œ<code>tail = m + n - 1</code> æŒ‡å‘åˆå¹¶åæ•°ç»„çš„å°¾éƒ¨ï¼›</li><li>æ¯è½®æ¯”è¾ƒ <code>nums1[p1]</code> å’Œ <code>nums2[p2]</code>ï¼ŒæŠŠè¾ƒå¤§çš„æ”¾å…¥ <code>nums1[tail]</code>ï¼Œç„¶åç§»åŠ¨å¯¹åº”æŒ‡é’ˆä»¥åŠ <code>tail</code>ï¼›</li><li>è‹¥ <code>nums2</code> è¿˜æœ‰å‰©ä½™å…ƒç´ ï¼ˆ<code>p2 &gt;= 0</code>ï¼‰ï¼Œç»§ç»­å†™å…¥ï¼›å¦‚æœåªå‰© <code>nums1</code> å…ƒç´ ï¼Œæ— éœ€å¤„ç†ï¼Œå› ä¸ºå®ƒä»¬å·²ç»åœ¨æ­£ç¡®ä½ç½®ã€‚</li></ol><p>åŒæŒ‡é’ˆä»åå¾€å‰å¡«å……å¯ä»¥é¿å…ç§»åŠ¨å¤§é‡å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="script">O</mi></mrow><mo>(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(m+n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathit">m</span><span class="mbin">+</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>ï¼Œç©ºé—´å¤æ‚åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="script">O</mi></mrow><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span>ã€‚</p><h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">self, nums1: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], m: <span class="hljs-built_in">int</span>, nums2: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], n: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        p1 = m - <span class="hljs-number">1</span><br>        p2 = n - <span class="hljs-number">1</span><br>        tail = m + n - <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">while</span> p2 &gt;= <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">if</span> p1 &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> nums1[p1] &gt; nums2[p2]:<br>                nums1[tail] = nums1[p1]<br>                p1 -= <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                nums1[tail] = nums2[p2]<br>                p2 -= <span class="hljs-number">1</span><br>            tail -= <span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2><ul><li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="script">O</mi></mrow><mo>(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(m+n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathit">m</span><span class="mbin">+</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>ï¼Œæ¯ä¸ªå…ƒç´ åªç§»åŠ¨ä¸€æ¬¡ï¼›</li><li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="script">O</mi></mrow><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span>ï¼ŒåŸåœ°åˆå¹¶æœªä½¿ç”¨é¢å¤–æ•°ç»„ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ›æ‰£ </tag>
            
            <tag> æ•°ç»„ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
