
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <title>RLHF çš„ä¸‰é˜¶æ®µæµç¨‹ | ä¹ä¹çš„ä¸ªäººåšå®¢ | JiuJiu&#39;s Blog</title>
  <meta name="description" content="ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„å¼€å‘è€…çš„ä¸ªäººåšå®¢ï¼Œåˆ†äº«ç¼–ç¨‹ã€æŠ€æœ¯å’Œç”Ÿæ´»æ„Ÿæ‚Ÿã€‚">
  <meta name="keywords" content="LLM">
  <meta name="author" content="ZhenWusi">

  <meta property="og:title" content="RLHF çš„ä¸‰é˜¶æ®µæµç¨‹">
  <meta property="og:description" content="ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„å¼€å‘è€…çš„ä¸ªäººåšå®¢ï¼Œåˆ†äº«ç¼–ç¨‹ã€æŠ€æœ¯å’Œç”Ÿæ´»æ„Ÿæ‚Ÿã€‚">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://zhenwusi.github.io/2026/02/23/RLHF%20%E7%9A%84%E4%B8%89%E9%98%B6%E6%AE%B5%E6%B5%81%E7%A8%8B/index.html">
  <meta property="og:image" content="/img/%E5%A4%B4%E5%83%8F.jpg">

  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/%E5%A4%B4%E5%83%8F.jpg">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

  <!-- highlight.js CSSï¼ˆHexo æ„å»ºæ—¶å·²å®Œæˆè¯­æ³•é«˜äº®ï¼Œåªéœ€åŠ è½½æ ·å¼ï¼‰ -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">
  

  <!-- KaTeX CSSï¼ˆæ–¹å¼ A å’Œ B å…±ç”¨ï¼ŒåªåŠ è½½ä¸€æ¬¡ï¼‰ -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  

  <!-- Font Awesome / Iconify -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script defer src="https://code.iconify.design/iconify-icon/1.0.8/iconify-icon.min.js"></script>

  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="ä¹ä¹çš„ä¸ªäººåšå®¢ | JiuJiu's Blog" type="application/atom+xml">
</head>
<body>
  <div id="loading-mask"><div class="spinner"></div></div>

  

<!-- é¡¶éƒ¨å¯¼èˆªæ  -->
<header class="site-header" id="site-header">
  <div class="header-inner">
    <!-- æ¡Œé¢ç«¯å¯¼èˆªèœå• -->
    <nav class="site-nav" id="site-nav">
      
        <a href="/" class="nav-link">
          
            <iconify-icon icon="mingcute:home-2-fill"></iconify-icon>
          
          <span class="nav-text">é¦–é¡µ</span>
        </a>
      
        <a href="/archives" class="nav-link">
          
            <iconify-icon icon="mingcute:inbox-fill"></iconify-icon>
          
          <span class="nav-text">æ–‡ç« </span>
        </a>
      
        <a href="/about" class="nav-link">
          
            <iconify-icon icon="mingcute:user-info-fill"></iconify-icon>
          
          <span class="nav-text">å…³äº</span>
        </a>
      
        <a href="/categories" class="nav-link">
          
            <iconify-icon icon="mingcute:classify-2-fill"></iconify-icon>
          
          <span class="nav-text">åˆ†ç±»</span>
        </a>
      
        <a href="/tags" class="nav-link">
          
            <iconify-icon icon="mingcute:tag-fill"></iconify-icon>
          
          <span class="nav-text">æ ‡ç­¾</span>
        </a>
      
    </nav>

    <!-- åŠŸèƒ½æŒ‰é’®åŒºåŸŸ -->
    <div class="header-actions">
      <!-- æœç´¢æŒ‰é’® -->
      <button class="action-btn" id="search-toggle" title="æœç´¢">
        <i class="fas fa-search"></i>
      </button>
      <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
      <button class="action-btn mobile-menu-btn" id="mobile-menu-toggle">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </div>

  <!-- æœç´¢å¼¹çª— -->
  <div class="search-overlay" id="search-overlay">
    <div class="search-box">
      <input type="text" id="search-input" placeholder="æœç´¢æ–‡ç« ..." autocomplete="off">
      <button id="search-close"><i class="fas fa-times"></i></button>
    </div>
    <div class="search-results" id="search-results"></div>
  </div>
</header>

<!-- ç§»åŠ¨ç«¯ä¾§æ»‘èœå• -->
<div class="mobile-menu-overlay" id="mobile-menu-overlay"></div>
<aside class="mobile-menu" id="mobile-menu">
  <div class="mobile-menu-header">
    
      <img src="/img/å¤´åƒ.jpg" alt="å¤´åƒ" class="mobile-avatar">
    
    <h3>ZhenWusi</h3>
    
      <p>é¾™å‡ºæµ·ï¼Œè™ä¸‹å±±â€¦â€¦ | Exploring code &amp; AI</p>
    
  </div>
  <nav class="mobile-nav">
    
      <a href="/" class="mobile-nav-link">
        
          <iconify-icon icon="mingcute:home-2-fill"></iconify-icon>
        
        <span class="nav-text">é¦–é¡µ</span>
      </a>
    
      <a href="/archives" class="mobile-nav-link">
        
          <iconify-icon icon="mingcute:inbox-fill"></iconify-icon>
        
        <span class="nav-text">æ–‡ç« </span>
      </a>
    
      <a href="/about" class="mobile-nav-link">
        
          <iconify-icon icon="mingcute:user-info-fill"></iconify-icon>
        
        <span class="nav-text">å…³äº</span>
      </a>
    
      <a href="/categories" class="mobile-nav-link">
        
          <iconify-icon icon="mingcute:classify-2-fill"></iconify-icon>
        
        <span class="nav-text">åˆ†ç±»</span>
      </a>
    
      <a href="/tags" class="mobile-nav-link">
        
          <iconify-icon icon="mingcute:tag-fill"></iconify-icon>
        
        <span class="nav-text">æ ‡ç­¾</span>
      </a>
    
  </nav>
</aside>


  <main class="main-content">
    <!-- æ–‡ç« è¯¦æƒ…é¡µå¸ƒå±€ -->



<!-- æ–‡ç« é¡¶éƒ¨æ¨ªå¹… -->
<section class="post-banner" style="background-image: url('/img/background/')">
  <div class="hero-overlay"></div>
  <div class="post-banner-content">
    <!-- åˆ†ç±» -->
    
      <div class="post-banner-cats">
        
          <a href="/categories/%E7%AE%97%E6%B3%95/"><i class="fas fa-folder"></i> ç®—æ³•</a>
        
      </div>
    
    <h1 class="post-banner-title">RLHF çš„ä¸‰é˜¶æ®µæµç¨‹</h1>
    <div class="post-banner-meta">
      <span><i class="far fa-calendar-alt"></i> 2026-02-23</span>
      <span><i class="far fa-clock"></i> é˜…è¯»çº¦ 2.5k å­—</span>
      
        <span><i class="fas fa-tags"></i>
          
          LLM
        </span>
      
    </div>
  </div>
</section>

<!-- æ–‡ç« ä¸»ä½“ -->
<div class="reading-progress"><span class="reading-progress__bar"></span></div>
<div class="container post-container">
  <div class="post-layout">
    <!-- æ–‡ç« å†…å®¹åŒºåŸŸ -->
    <article class="post-content-wrap">
      <!-- ç›®å½•ï¼ˆTOCï¼‰ -->
      
        <div class="post-toc-mobile" id="toc-mobile">
          <details>
            <summary><i class="fas fa-list"></i> æ–‡ç« ç›®å½•</summary>
            <div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%863"><span class="toc-text">åŸºç¡€çŸ¥è¯†3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RLHF-%E7%9A%84%E4%B8%89%E9%98%B6%E6%AE%B5%E6%B5%81%E7%A8%8B"><span class="toc-text">RLHF çš„ä¸‰é˜¶æ®µæµç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B6%E6%AE%B5%E4%B8%80%EF%BC%9ASFT%EF%BC%88Supervised-Fine-Tuning%EF%BC%89"><span class="toc-text">é˜¶æ®µä¸€ï¼šSFTï¼ˆSupervised Fine-Tuningï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B6%E6%AE%B5%E4%BA%8C%EF%BC%9A%E5%A5%96%E5%8A%B1%E6%A8%A1%E5%9E%8B%EF%BC%88Reward-Modeling%EF%BC%89"><span class="toc-text">é˜¶æ®µäºŒï¼šå¥–åŠ±æ¨¡å‹ï¼ˆReward Modelingï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E8%A7%A3%E9%87%8A"><span class="toc-text">è¡¥å……è§£é‡Š</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B6%E6%AE%B5%E4%B8%89%EF%BC%9ARL-%E5%BE%AE%E8%B0%83"><span class="toc-text">é˜¶æ®µä¸‰ï¼šRL å¾®è°ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E8%A7%A3%E9%87%8A-2"><span class="toc-text">è¡¥å……è§£é‡Š</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%81%8F%E5%A5%BD%E4%BC%98%E5%8C%96%EF%BC%88Direct-Preference-Optimization%EF%BC%89"><span class="toc-text">ç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDirect Preference Optimizationï¼‰</span></a></li></ol></li></ol></div>
          </details>
        </div>
      

      <!-- æ­£æ–‡ -->
      <div class="post-body markdown-body" id="post-body">
        <h1>1</h1>
<h2 id="åŸºç¡€çŸ¥è¯†3">åŸºç¡€çŸ¥è¯†3</h2>
<h3 id="RLHF-çš„ä¸‰é˜¶æ®µæµç¨‹">RLHF çš„ä¸‰é˜¶æ®µæµç¨‹</h3>
<p>RLHFï¼ˆReinforcement Learning from Human Feedbackï¼‰é€šå¸¸åŒ…å«ä¸‰ä¸ªä¸»è¦é˜¶æ®µï¼š</p>
<p><strong>ç›‘ç£å¾®è°ƒï¼ˆSFTï¼‰â†’ åå¥½é‡‡æ · + å¥–åŠ±æ¨¡å‹å­¦ä¹  â†’ å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–ï¼ˆRLï¼‰</strong></p>
<p>ç®€å•å¯ä»¥ç†è§£ä¸ºï¼šå…ˆå­¦&quot;æ€ä¹ˆè¯´è¯&quot;ï¼Œå†å­¦&quot;ä»€ä¹ˆè¯æ›´å¥½&quot;ï¼Œæœ€åé€¼æ¨¡å‹å¤šè¯´&quot;å¥½è¯&quot;</p>
<h4 id="é˜¶æ®µä¸€ï¼šSFTï¼ˆSupervised-Fine-Tuningï¼‰">é˜¶æ®µä¸€ï¼šSFTï¼ˆSupervised Fine-Tuningï¼‰</h4>
<p>RLHF é€šå¸¸ä»å¯¹ä¸€ä¸ªé¢„è®­ç»ƒè¯­è¨€æ¨¡å‹è¿›è¡Œç›‘ç£å¾®è°ƒå¼€å§‹ï¼Œä½¿ç”¨é«˜è´¨é‡çš„äººå·¥æ•°æ®ï¼ˆå¦‚å¯¹è¯ã€æ‘˜è¦ç­‰ï¼‰ï¼Œå¾—åˆ°ä¸€ä¸ªæ¨¡å‹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\pi_{SFT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ã€‚</p>
<p><strong>æ•°æ®å½¢å¼</strong>: (\text{prompt} \, x, \text{é«˜è´¨é‡å›ç­”} \, y)</p>
<p><strong>æŸå¤±å‡½æ•°</strong>: æ ‡å‡†çš„ç›‘ç£å­¦ä¹ æŸå¤±å‡½æ•°</p>
\begin{equation}\label{eq:sft_loss}
\max_{\theta} \sum_{(x,y) \in D} \log \pi_\theta(y|x)
\end{equation}
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mi>Î¸</mi></msub></mrow><annotation encoding="application/x-tex">\pi_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼šç­–ç•¥æ¨¡å‹çš„å‚æ•°åŒ–å½¢å¼</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span></span>ï¼šç›‘ç£å¾®è°ƒæ•°æ®é›†</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span></span></span></span>ï¼šè¾“å…¥æç¤º</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span>ï¼šç›®æ ‡å›ç­”</li>
</ul>
<p><strong>ç›®æ ‡</strong>: è®©æ¨¡å‹å­¦ä¼šåŸºæœ¬çš„å¯¹è¯èƒ½åŠ›å’Œä»»åŠ¡å®Œæˆèƒ½åŠ›ï¼Œå³&quot;æ€ä¹ˆè¯´è¯&quot;</p>
<h4 id="é˜¶æ®µäºŒï¼šå¥–åŠ±æ¨¡å‹ï¼ˆReward-Modelingï¼‰">é˜¶æ®µäºŒï¼šå¥–åŠ±æ¨¡å‹ï¼ˆReward Modelingï¼‰</h4>
<p>ä½¿ç”¨ SFT æ¨¡å‹ï¼Œå¯¹åŒä¸€ä¸ª prompt <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span></span></span></span> é‡‡æ ·ä¸¤ä¸ªå›ç­”ï¼š</p>
\begin{equation}\label{eq:sample}
y_1, y_2 \sim \pi_{SFT}(y|x)
\end{equation}
<p>äº¤ç»™äººç±»æ ‡æ³¨è€…ï¼Œè®©ä»–ä»¬é€‰æ›´å¥½çš„ä¸€ä¸ªï¼š</p>
\begin{equation}\label{eq:preference}
y_w \succ y_l \mid x
\end{equation}
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">y_w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼šwinner,preferredï¼ˆèµ¢å®¶ï¼‰</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>l</mi></msub></mrow><annotation encoding="application/x-tex">y_l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼šloser,rejectedï¼ˆè¾“å®¶ï¼‰</li>
</ul>
<p><strong>æ½œåœ¨å¥–åŠ±å‡½æ•°å‡è®¾</strong>: å‡è®¾äººç±»åå¥½æ˜¯ç”±ä¸€ä¸ªæœªçŸ¥çš„çœŸå®å¥–åŠ±å‡½æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>r</mi><mo>âˆ—</mo></msup><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">r^*(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">âˆ—</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> ç”Ÿæˆçš„ã€‚æˆ‘ä»¬å¹¶ä¸çŸ¥é“å®ƒï¼Œä½†å‡è®¾å®ƒå­˜åœ¨ã€‚</p>
<p><strong>åå¥½æ¨¡å‹</strong>:</p>
\begin{equation}\label{eq:bt_model}
p^*(y_1 > y_2 | x) = \frac{\exp(r^*(x, y_1))}{\exp(r^*(x, y_1)) + \exp(r^*(x, y_2))}
\end{equation}
<p><strong>æ•°æ®é›†å½¢å¼</strong>:</p>
\begin{equation}\label{eq:dataset}
D = \{(x^{(i)}, y_w^{(i)}, y_l^{(i)})\}_{i=1}^N
\end{equation}
<p><strong>æŸå¤±å‡½æ•°</strong>:</p>
\begin{equation}\label{eq:rm_loss}
\mathcal{L}_\text{R}(r_\phi, \mathcal{D}) = -\mathbb{E}_{(x, y_w, y_l) \sim \mathcal{D}} \left[ \log \sigma (r_\phi(x, y_w) - r_\phi(x, y_l)) \right]
\end{equation}
<hr>
<h5 id="è¡¥å……è§£é‡Š">è¡¥å……è§£é‡Š</h5>
<p>BT æ¨¡å‹ï¼š</p>
<p>Bradley-Terry æ¨¡å‹æ˜¯ä¸€ä¸ªç”¨äº<strong>æˆå¯¹æ¯”è¾ƒ</strong>çš„æ¦‚ç‡æ¨¡å‹</p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>:</p>
<ul>
<li>æ¯ä¸ªå¯¹è±¡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> æœ‰ä¸€ä¸ªéšè—çš„&quot;å®åŠ›å€¼&quot;å‚æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î»</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\lambda_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">Î»</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span></li>
<li>å½“ä¸¤ä¸ªå¯¹è±¡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span></span> æ¯”è¾ƒæ—¶ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> æˆ˜èƒœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span></span> çš„æ¦‚ç‡ä¸ºï¼š</li>
</ul>
\begin{equation}\label{eq:bt_prob}
P(i \succ j) = \frac{\lambda_i}{\lambda_i + \lambda_j}
\end{equation}
<p><strong>åœ¨ DPO ä¸­çš„åº”ç”¨</strong>:</p>
<ul>
<li>å°†å¥–åŠ±å‡½æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">r(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> çœ‹ä½œ&quot;å®åŠ›å€¼&quot;</li>
<li>äººç±»åå¥½ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>w</mi></msub><mo>â‰»</mo><msub><mi>y</mi><mi>l</mi></msub></mrow><annotation encoding="application/x-tex">y_w \succ y_l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.5391em;"></span><span class="strut bottom" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mrel">â‰»</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> å°±æ˜¯&quot;æ¯”è¾ƒç»“æœ&quot;</li>
<li>é€šè¿‡ BT æ¨¡å‹å»ºç«‹å¥–åŠ±ä¸åå¥½çš„æ¡¥æ¢</li>
</ul>
<p>ä¸ºä»€ä¹ˆä¸ç”¨ã€Œè°åˆ†æ•°å¤§å°±é€‰è°ã€ï¼Ÿ</p>
<p>å¦‚æœç›´æ¥è§„å®š: $$ y_1 \succ y_2 \iff r^<em>(x,y_1) &gt; r^</em>(x,y_2) $$<br>
é‚£é—®é¢˜æ˜¯: äººç±»åˆ¤æ–­æœ‰å™ªå£°ï¼ŒåŒä¸€ä¸ªäººã€åŒä¸€ä¸ªé—®é¢˜ï¼Œä¸ä¸€å®šæ¯æ¬¡é€‰åŒæ ·çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸å»ºæ¨¡æˆç¡®å®šæ€§è§„åˆ™ï¼Œè€Œæ˜¯: æ¦‚ç‡æ¨¡å‹</p>
<p>æŠŠå…¬å¼ \eqref{eq:bt_model} æ”¹å†™ä¸€ä¸‹ï¼š</p>
\begin{equation}\label{eq:bt_sigmoid}
p^*(y_1 \succ y_2 \mid x) = \frac{1}{1 + e^{-(r^*(x,y_1) - r^*(x,y_2))}}
\end{equation}
<p>è¿™å°±æ˜¯ç†Ÿæ‚‰çš„ Sigmoid å‡½æ•°:</p>
\begin{equation}\label{eq:sigmoid}
\sigma(z) = \frac{1}{1 + e^{-z}}
\end{equation}
<p>äºæ˜¯:</p>
\begin{equation}\label{eq:bt_final}
p^*(y_1 \succ y_2 \mid x) = \sigma(r^*(x,y_1) - r^*(x,y_2))
\end{equation}
<p>å› ä¸ºçœŸå®æ•°æ®é‡Œäººç¡®å®é€‰æ‹©äº† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">y_w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼Œæ‰€ä»¥è¯¥äº‹ä»¶çš„æ¦‚ç‡æ˜¯ä¸Šå¼ï¼Œå¯¹æ•°ä¼¼ç„¶æ˜¯ï¼š</p>
\begin{equation}\label{eq:log_likelihood}
\log p_\theta(y_w \succ y_l \mid x) = \log \sigma(r_\theta(x,y_w) - r_\theta(x,y_l))
\end{equation}
<p>æœ€å¤§åŒ–æ‰€æœ‰æ ·æœ¬çš„å¯¹æ•°ä¼¼ç„¶ï¼š</p>
\begin{equation}\label{eq:max_likelihood}
\max_\theta \sum_{i=1}^N \log \sigma(r_\theta(x^{(i)}, y_w^{(i)}) - r_\theta(x^{(i)}, y_l^{(i)}))
\end{equation}
<p>æ„æ€æ˜¯: å¯¹æ¯ä¸€æ¡æ•°æ®ï¼Œéƒ½ç®—ä¸€æ¬¡&quot;æ¨¡å‹è®¤ä¸ºäººç±»ä¼šé€‰èµ¢å®¶çš„æ¦‚ç‡çš„å¯¹æ•°&quot;ï¼Œç„¶åæŠŠå®ƒä»¬åŠ èµ·æ¥ï¼Œè®©è¿™ä¸ªæ€»å’Œå°½å¯èƒ½å¤§ã€‚å¯¹æ•°æŠŠâ€œè¿ä¹˜â€å˜æˆâ€œè¿åŠ â€ï¼Œæœ€ä¼˜è§£ä¸å˜ï¼ˆå¯¹æ•°æ˜¯å•è°ƒé€’å¢å‡½æ•°ï¼‰</p>
<p>ç­‰ä»·åœ°ï¼Œæœ€å°åŒ–è´Ÿå¯¹æ•°ä¼¼ç„¶ï¼ˆLikelihoodï¼‰ï¼š</p>
\begin{equation}\label{eq:negative_likelihood}
L_R = -\mathbb{E}_{(x,y_w,y_l) \sim D} [\log \sigma(r_\theta(x,y_w) - r_\theta(x,y_l))]
\end{equation}
<p>è¿™æ­£æ˜¯å…¬å¼ \eqref{eq:rm_loss}ã€‚æ„æ€æ˜¯: å¯¹æ•°æ®é›†é‡Œçš„æ ·æœ¬å–å¹³å‡ï¼Œç„¶åå¯¹&quot;å¯¹æ•°æ¦‚ç‡&quot;å–è´Ÿå·ï¼Œè®©è¿™ä¸ªå€¼å°½å¯èƒ½å°ã€‚</p>
<p>å¯¹ä¸€ä¸ªæœ‰é™æ•°æ®é›† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mo>=</mo><mo>{</mo><msub><mi>z</mi><mn>1</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>z</mi><mi>N</mi></msub><mo>}</mo></mrow><annotation encoding="application/x-tex">D = \{z_1, ..., z_N\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mrel">=</span><span class="mopen">{</span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.04398em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mpunct">,</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.04398em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mclose">}</span></span></span></span>ï¼Œå¦‚æœä½ å‡åŒ€éšæœºä»ä¸­æŠ½ä¸€ä¸ªæ ·æœ¬ï¼Œé‚£ä¹ˆï¼š</p>
\begin{equation}\label{eq:expectation}
\mathbb{E}_{z \sim D} [f(z)] = \frac{1}{N} \sum_{i=1}^N f(z_i)
\end{equation}
<p>ğŸ‘‰ æœŸæœ› = å¹³å‡å€¼</p>
<p>ä»¤ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>y</mi><mi>w</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>l</mi></msub><mo>)</mo><mo>=</mo><mi>log</mi><mi>Ïƒ</mi><mo>(</mo><msub><mi>r</mi><mi>Î¸</mi></msub><mo>(</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>y</mi><mi>w</mi></msub><mo>)</mo><mo>âˆ’</mo><msub><mi>r</mi><mi>Î¸</mi></msub><mo>(</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>y</mi><mi>l</mi></msub><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">f(x,y_w,y_l) = \log\sigma(r_\theta(x,y_w)-r_\theta(x,y_l))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mord mathit" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mclose">)</span><span class="mbin">âˆ’</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span> é‚£ä¹ˆï¼š</p>
\begin{equation}\label{eq:expectation_rm}
\mathbb{E}_{(x,y_w,y_l) \sim D} [f] = \frac{1}{N} \sum_{i=1}^N \log \sigma(r_\theta(x^{(i)}, y_w^{(i)}) - r_\theta(x^{(i)}, y_l^{(i)}))
\end{equation}
<p>å› ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\sum_{i=1}^N f_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8423309999999999em;"></span><span class="strut bottom" style="height:1.142341em;vertical-align:-0.30001em;"></span><span class="base textstyle uncramped"><span class="mop"><span class="op-symbol small-op mop" style="top:-0.0000050000000000050004em;">âˆ‘</span><span class="vlist"><span style="top:0.30001em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.364em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.10764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mi>N</mi></mrow></mfrac><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\frac{1}{N} \sum_{i=1}^N f_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.845108em;"></span><span class="strut bottom" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mop"><span class="op-symbol small-op mop" style="top:-0.0000050000000000050004em;">âˆ‘</span><span class="vlist"><span style="top:0.30001em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.364em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.10764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> åªå·®ä¸€ä¸ªå¸¸æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mi>N</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{N}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.845108em;"></span><span class="strut bottom" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span>ã€‚è€Œåœ¨ä¼˜åŒ–ä¸­: ä¹˜ä»¥ä¸€ä¸ªæ­£çš„å¸¸æ•°ï¼Œä¸ä¼šæ”¹å˜æœ€ä¼˜è§£çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´:</p>
\begin{equation}\label{eq:argmax_equiv}
\arg\max_\theta \sum_{i=1}^N f_i = \arg\max_\theta \frac{1}{N} \sum_{i=1}^N f_i
\end{equation}
<p>åŸç›®æ ‡ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>max</mi><mi>Î¸</mi></msub><msub><mrow><mi mathvariant="double-struck">E</mi></mrow><mi>D</mi></msub><mo>[</mo><mi>log</mi><mi>Ïƒ</mi><mo>(</mo><mo>â‹…</mo><mo>)</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">\max_\theta \mathbb{E}_D [\log \sigma(\cdot)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mop"><span class="mop">max</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class=""><span class="mord textstyle uncramped"><span class="mord mathbb">E</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">[</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mord mathit" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord">â‹…</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span></p>
<p>ç­‰ä»·äºï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>min</mi><mi>Î¸</mi></msub><mo>âˆ’</mo><msub><mrow><mi mathvariant="double-struck">E</mi></mrow><mi>D</mi></msub><mo>[</mo><mi>log</mi><mi>Ïƒ</mi><mo>(</mo><mo>â‹…</mo><mo>)</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">\min_\theta -\mathbb{E}_D [\log \sigma(\cdot)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mop"><span class="mop">min</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord">âˆ’</span><span class=""><span class="mord textstyle uncramped"><span class="mord mathbb">E</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">[</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mord mathit" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord">â‹…</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span></p>
<p>äºæ˜¯å®šä¹‰ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>R</mi></msub><mo>=</mo><mo>âˆ’</mo><msub><mrow><mi mathvariant="double-struck">E</mi></mrow><mi>D</mi></msub><mo>[</mo><mi>log</mi><mi>Ïƒ</mi><mo>(</mo><mo>â‹…</mo><mo>)</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">L_R = -\mathbb{E}_D [\log \sigma(\cdot)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mrel">=</span><span class="mord">âˆ’</span><span class=""><span class="mord textstyle uncramped"><span class="mord mathbb">E</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">[</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mord mathit" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord">â‹…</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span></p>
<p><strong>ä¸ºä»€ä¹ˆæœºå™¨å­¦ä¹ é‡Œ&quot;æ€»æ˜¯æœ€å°åŒ–&quot;ï¼Ÿ</strong></p>
<p>å› ä¸ºæ¢¯åº¦ä¸‹é™ï¼ˆGradient Descentï¼‰é»˜è®¤æ˜¯ minimize lossï¼Œæ‰€ä»¥å¤§å®¶ä¹ æƒ¯ï¼šæŠŠ&quot;æƒ³æœ€å¤§åŒ–çš„ç›®æ ‡&quot;ï¼Œå†™æˆ&quot;è¦æœ€å°åŒ–çš„æŸå¤±&quot;ã€‚</p>
<hr>
<h4 id="é˜¶æ®µä¸‰ï¼šRL-å¾®è°ƒ">é˜¶æ®µä¸‰ï¼šRL å¾®è°ƒ</h4>
<p><strong>RL ç›®æ ‡å‡½æ•°ï¼ˆæ ¸å¿ƒï¼‰</strong>ï¼š</p>
\begin{equation}\label{eq:rl_objective}
\max_{\pi_\theta} \mathbb{E}_{x \sim \mathcal{D}, y \sim \pi_\theta(y|x)} \left[ r_\phi(x, y) - \beta D_{\text{KL}} \left[ \pi_\theta(y|x) \middle\| \pi_{\text{ref}}(y|x) \right] \right]
\end{equation}
<hr>
<h5 id="è¡¥å……è§£é‡Š-2">è¡¥å……è§£é‡Š</h5>
<p>ä¸€å¥è¯è§£é‡Šï¼šğŸ‘‰ è®©æ¨¡å‹ç”Ÿæˆ å¥–åŠ±é«˜çš„å›ç­” ğŸ‘‰ ä½†ä¸èƒ½åç¦»åŸå§‹ SFT æ¨¡å‹å¤ªè¿œ</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mrow><mi>r</mi><mi>e</mi><mi>f</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\pi_{ref}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼ˆå³åˆå§‹æ¨¡å‹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\pi_{SFT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼‰å®è·µä¸­ï¼Œè¯­è¨€æ¨¡å‹ç­–ç•¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mi>Î¸</mi></msub></mrow><annotation encoding="application/x-tex">\pi_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> ä¹Ÿè¢«åˆå§‹åŒ–ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\pi_{SFT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ã€‚</p>
<ul>
<li><strong>åˆå§‹çŠ¶æ€</strong>ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mi>Î¸</mi></msub><mo>=</mo><msub><mi>Ï€</mi><mrow><mi>r</mi><mi>e</mi><mi>f</mi></mrow></msub><mo>=</mo><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\pi_\theta = \pi_{ref} = \pi_{SFT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span></li>
<li><strong>è®­ç»ƒç›®æ ‡</strong>ï¼šåœ¨ä¿æŒä¸åŸå§‹ SFT æ¨¡å‹æ¥è¿‘çš„å‰æä¸‹ï¼Œä¼˜åŒ–å¥–åŠ±</li>
<li><strong>KL çº¦æŸä½œç”¨</strong>ï¼šç¡®ä¿æ¨¡å‹ä¸ä¼šåç¦»åˆå§‹èƒ½åŠ›å¤ªè¿œ</li>
</ul>
<p><strong>KL çº¦æŸï¼š</strong></p>
<p>KL æ•£åº¦ï¼ˆKullback-Leibler æ•£åº¦ï¼‰è¡¡é‡ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„å·®å¼‚ï¼š</p>
\begin{equation}\label{eq:kl_general}
D_{\text{KL}}[P \| Q] = \sum_x P(x) \log \frac{P(x)}{Q(x)}
\end{equation}
\begin{equation}\label{eq:kl_policy}
D_{\text{KL}}[\pi_\theta(y|x) \| \pi_{SFT}(y|x)] = \mathbb{E}_{y \sim \pi_\theta} \left[ \log \frac{\pi_\theta(y|x)}{\pi_{SFT}(y|x)} \right]
\end{equation}
<p>è¿™è¡¨ç¤ºï¼š</p>
<ul>
<li>å¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mi>Î¸</mi></msub></mrow><annotation encoding="application/x-tex">\pi_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\pi_{SFT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> ç›¸åŒï¼šKL = 0</li>
<li>å¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mi>Î¸</mi></msub></mrow><annotation encoding="application/x-tex">\pi_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> åç¦» <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\pi_{SFT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼šKL &gt; 0</li>
<li>ç›®æ ‡å‡½æ•°ä¸­çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>âˆ’</mo><mi>Î²</mi><mi>K</mi><mi>L</mi></mrow><annotation encoding="application/x-tex">-\beta KL</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord">âˆ’</span><span class="mord mathit" style="margin-right:0.05278em;">Î²</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathit">L</span></span></span></span> æƒ©ç½šåç¦»è¡Œä¸º</li>
</ul>
<p><strong>KL æ•£åº¦æ¨å¯¼è¿‡ç¨‹è¯¦è§£</strong></p>
<p><strong>KL æ•£åº¦çš„é€šç”¨å®šä¹‰ï¼ˆç¦»æ•£å‹ï¼‰</strong>:</p>
\begin{equation}\label{eq:kl_discrete}
D_{\text{KL}}[P \| Q] = \sum_i P(i) \log \frac{P(i)}{Q(i)}
\end{equation}
<p><strong>æœŸæœ›çš„å®šä¹‰</strong>:<br>
å¯¹äºéšæœºå˜é‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Y</mi><mo>âˆ¼</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">Y \sim P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.22222em;">Y</span><span class="mrel">âˆ¼</span><span class="mord mathit" style="margin-right:0.13889em;">P</span></span></span></span>ï¼Œå‡½æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>Y</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">f(Y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span> çš„æœŸæœ›å®šä¹‰ä¸º:</p>
\begin{equation}\label{eq:expectation_def}
\mathbb{E}_{Y \sim P}[f(Y)] = \sum_{y \in \mathcal{Y}} P(y) f(y)
\end{equation}
<p><strong>è¿›è¡Œå˜é‡æ˜ å°„</strong></p>
<p>åœ¨ RLHF çš„è¯­å¢ƒä¸‹ï¼Œæˆ‘ä»¬è¦è®¡ç®—çš„æ˜¯ä¸¤ä¸ªæ¨¡å‹ç­–ç•¥ï¼ˆæ¦‚ç‡åˆ†å¸ƒï¼‰ä¹‹é—´çš„å·®å¼‚ï¼š</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span></span></span></span>** (å½“å‰åˆ†å¸ƒ)**ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mi>Î¸</mi></msub><mo>(</mo><mi>y</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\pi_\theta(y|x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathrm">âˆ£</span><span class="mord mathit">x</span><span class="mclose">)</span></span></span></span> â€”â€” æ¨¡å‹å½“å‰æ­£åœ¨å­¦ä¹ çš„ç­–ç•¥</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">Q</span></span></span></span>** (å‚è€ƒåˆ†å¸ƒ)**ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub><mo>(</mo><mi>y</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\pi_{SFT}(y|x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathrm">âˆ£</span><span class="mord mathit">x</span><span class="mclose">)</span></span></span></span> â€”â€” åŸå§‹çš„ SFT ç­–ç•¥</li>
<li><strong>æ ·æœ¬ç©ºé—´</strong>ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span>ï¼ˆæ¨¡å‹ç”Ÿæˆçš„æ‰€æœ‰å¯èƒ½çš„å›ç­”åºåˆ—ï¼‰</li>
</ul>
<p>å°†è¿™äº›ä»£å…¥é€šç”¨å…¬å¼ï¼š</p>
\begin{equation}\label{eq:kl_substitute}
D_{\text{KL}}[\pi_\theta \| \pi_{SFT}] = \sum_y \pi_\theta(y|x) \log \frac{\pi_\theta(y|x)}{\pi_{SFT}(y|x)}
\end{equation}
<p><strong>è½¬åŒ–ä¸ºæœŸæœ›å½¢å¼</strong></p>
<p>å¤–å±‚åŠ æƒéƒ¨åˆ†ä¸è¢«åŠ æƒé¡¹æ”¹å†™å¦‚ä¸‹ï¼š</p>
\sum_{y} \pi_\theta(y|x) (\cdots) \quad \text{å’Œ} \quad \log \frac{\pi_\theta(y|x)}{\pi_{SFT}(y|x)}

<p>å‰è€…è¡¨ç¤º&quot;æŒ‰ç…§ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Ï€</mi><mi>Î¸</mi></msub><mo>(</mo><mi>y</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\pi_\theta(y|x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathrm">âˆ£</span><span class="mord mathit">x</span><span class="mclose">)</span></span></span></span> åˆ†å¸ƒåšåŠ æƒå¹³å‡&quot;ï¼Œåè€…æ˜¯è¢«å–æœŸæœ›çš„å¯¹è±¡ã€‚</p>
<p>å› æ­¤ï¼Œæ ¹æ® <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>âˆ‘</mo><mi>P</mi><mo>â‹…</mo><mi>f</mi><mo>=</mo><msub><mrow><mi mathvariant="double-struck">E</mi></mrow><mi>P</mi></msub><mo>[</mo><mi>f</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">\sum P \cdot f = \mathbb{E}_P[f]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="base textstyle uncramped"><span class="op-symbol small-op mop" style="top:-0.0000050000000000050004em;">âˆ‘</span><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mbin">â‹…</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mrel">=</span><span class=""><span class="mord textstyle uncramped"><span class="mord mathbb">E</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mclose">]</span></span></span></span> å¾—ï¼š</p>
\begin{equation}\label{eq:kl_expectation_form}
D_{\text{KL}}[\pi_\theta \| \pi_{SFT}] = \mathbb{E}_{y \sim \pi_\theta(y|x)} \left[ \log \frac{\pi_\theta(y|x)}{\pi_{SFT}(y|x)} \right].
\end{equation}
<p><strong>ä¸ºä»€ä¹ˆå®è·µä¸­è¦å†™æˆæœŸæœ›å½¢å¼ï¼Ÿ</strong></p>
<ol>
<li><strong>æ— æ³•å…¨é‡æ±‚å’Œ</strong>ï¼šè¯­è¨€æ¨¡å‹çš„è¾“å‡ºç©ºé—´å¤©æ–‡å·¨å¤§ï¼Œæ— æ³•æšä¸¾ $ y $ã€‚</li>
<li><strong>è’™ç‰¹å¡æ´›é‡‡æ ·</strong>ï¼šé€šè¿‡é‡‡æ · <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>âˆ¼</mo><msub><mi>Ï€</mi><mi>Î¸</mi></msub></mrow><annotation encoding="application/x-tex">y \sim \pi_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mrel">âˆ¼</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">Ï€</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">Î¸</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span>ï¼Œè®¡ç®—</li>
</ol>
\begin{equation}\label{eq:kl_sample}
\log \pi_\theta(y|x) - \log \pi_{SFT}(y|x)
\end{equation}
<p>çš„å¹³å‡å€¼å³å¯è¿‘ä¼¼ KLã€‚<br>
3. <strong>å¯¹é½ç›®æ ‡å‡½æ•°</strong>ï¼šåŸå§‹ RL ç›®æ ‡ä¹Ÿæ˜¯æœŸæœ›å½¢å¼ï¼Œå¯å†™æˆï¼š</p>
\begin{equation}\label{eq:rl_aligned}
\max_{\pi_\theta} \mathbb{E}_{y \sim \pi_\theta} \left[ r(x,y) - \beta \log \frac{\pi_\theta(y|x)}{\pi_{SFT}(y|x)} \right].
\end{equation}
<p>è¿™æ ·æ¯æ¬¡é‡‡æ ·å°±èƒ½åŒæ—¶æ›´æ–°å¥–åŠ±å’Œ KL æƒ©ç½šã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆè¿™ä¸ªç›®æ ‡å‡½æ•°ä¸å¯å¯¼ï¼Ÿ</strong></p>
<p>è¯­è¨€æ¨¡å‹ç”Ÿæˆåºåˆ—æ˜¯ç¦»æ•£æ“ä½œï¼Œå¯¼è‡´ $ \mathbb{E}<em>{y \sim \pi</em>\theta(y|x)}[r(x,y)] $ æ— æ³•ç›´æ¥å¯¹ $ \theta $ æ±‚å¯¼ï¼Œåªèƒ½ç”¨ç­–ç•¥æ¢¯åº¦ï¼ˆREINFORCE/PPOï¼‰ã€‚</p>
<hr>
<p><strong>KL çº¦æŸå¦‚ä½•å˜æˆâ€œå¥–åŠ±â€ï¼Ÿ</strong></p>
<p>å…ˆæŠŠå…¬å¼ \eqref{eq:rl_objective} çš„ KL é¡¹å†™æˆ log-prob å½¢å¼ï¼š</p>
\begin{equation}\label{eq:kl_logprob}
D_{\text{KL}}(\pi_\theta \| \pi_{ref}) = \mathbb{E}_{y \sim \pi_\theta} \left[ \log \pi_\theta(y|x) - \log \pi_{ref}(y|x) \right].
\end{equation}
<p>ä»£å›ç›®æ ‡ï¼š</p>
\begin{equation}\label{eq:objective_substituted}
\mathbb{E}_{y \sim \pi_\theta} \left[ r_\phi(x, y) - \beta \left( \log \pi_\theta(y|x) - \log \pi_{ref}(y|x) \right) \right].
\end{equation}
<p>äºæ˜¯å¯ä»¥å®šä¹‰æ–°çš„å¥–åŠ±ï¼š</p>
\begin{equation}\label{eq:new_reward}
r(x, y) = r_\phi(x, y) - \beta \left( \log \pi_\theta(y|x) - \log \pi_{ref}(y|x) \right),
\end{equation}
<p>å³è®ºæ–‡ä¸­å¸¸è§çš„ï¼š</p>
\begin{equation}\label{eq:new_reward_simplified}
r(x, y) = r_\phi(x, y) - \left( \log \pi_\theta(y|x) - \log \pi_{ref}(y|x) \right),
\end{equation}
<p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î²</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05278em;">Î²</span></span></span></span> å¯è¢«å¸æ”¶åˆ°ç³»æ•°é‡Œã€‚</p>
<p><strong>è½¬æ¢åçš„ç®€åŒ–ç›®æ ‡</strong></p>
\begin{equation}\label{eq:simplified_objective}
\max_{\pi_\theta} \mathbb{E}_{x \sim \mathcal{D},\, y \sim \pi_\theta(y|x)} \left[ r(x, y) \right],
\end{equation}
<p>æ­¤æ—¶ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">r(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> å·²å« KL æƒ©ç½šï¼Œæˆä¸ºæ— çº¦æŸå¥–åŠ±æœ€å¤§åŒ–é—®é¢˜ã€‚</p>
<hr>
<h2 id="ç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDirect-Preference-Optimizationï¼‰">ç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDirect Preference Optimizationï¼‰</h2>

      </div>

      <!-- ç‰ˆæƒå£°æ˜ -->
      
        <div class="post-copyright">
          <p><strong><i class="fas fa-copyright"></i> ç‰ˆæƒå£°æ˜</strong></p>
          <p>æœ¬æ–‡ä½œè€…ï¼šZhenWusi</p>
          <p>æœ¬æ–‡é“¾æ¥ï¼š<a href="https://zhenwusi.github.io/2026/02/23/RLHF%20%E7%9A%84%E4%B8%89%E9%98%B6%E6%AE%B5%E6%B5%81%E7%A8%8B/">https://zhenwusi.github.io/2026/02/23/RLHF%20%E7%9A%84%E4%B8%89%E9%98%B6%E6%AE%B5%E6%B5%81%E7%A8%8B/</a></p>
          <p>é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œæœ¬ç«™æ‰€æœ‰æ–‡ç« å‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
        </div>
      

      <!-- æ–‡ç« æ ‡ç­¾ -->
      
        <div class="post-tags">
          
            <a href="/tags/LLM/" class="tag-item">
              <i class="fas fa-hashtag"></i>LLM
            </a>
          
        </div>
      

      <!-- ä¸Šä¸€ç¯‡ / ä¸‹ä¸€ç¯‡å¯¼èˆª -->
      <nav class="post-nav">
        
          <span class="post-nav-item prev disabled"></span>
        
        
          <a href="/2026/02/23/%E5%8A%9B%E6%89%A3/" class="post-nav-item next">
            <span class="post-nav-label">ä¸‹ä¸€ç¯‡ <i class="fas fa-chevron-right"></i></span>
            <span class="post-nav-title">åŠ›æ‰£ 88ï¼šåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</span>
          </a>
        
      </nav>

      <!-- è¯„è®ºåŒº -->
      <!-- è¯„è®ºç³»ç»Ÿç»„ä»¶ -->


    </article>

    <!-- ä¾§è¾¹æ ç›®å½•ï¼ˆæ¡Œé¢ç«¯ï¼‰ -->
    
      <aside class="post-sidebar" id="post-sidebar">
        <div class="sidebar-toc">
          <h3><i class="fas fa-list"></i> æ–‡ç« ç›®å½•</h3>
          <div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%863"><span class="toc-text">åŸºç¡€çŸ¥è¯†3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RLHF-%E7%9A%84%E4%B8%89%E9%98%B6%E6%AE%B5%E6%B5%81%E7%A8%8B"><span class="toc-text">RLHF çš„ä¸‰é˜¶æ®µæµç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B6%E6%AE%B5%E4%B8%80%EF%BC%9ASFT%EF%BC%88Supervised-Fine-Tuning%EF%BC%89"><span class="toc-text">é˜¶æ®µä¸€ï¼šSFTï¼ˆSupervised Fine-Tuningï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B6%E6%AE%B5%E4%BA%8C%EF%BC%9A%E5%A5%96%E5%8A%B1%E6%A8%A1%E5%9E%8B%EF%BC%88Reward-Modeling%EF%BC%89"><span class="toc-text">é˜¶æ®µäºŒï¼šå¥–åŠ±æ¨¡å‹ï¼ˆReward Modelingï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E8%A7%A3%E9%87%8A"><span class="toc-text">è¡¥å……è§£é‡Š</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B6%E6%AE%B5%E4%B8%89%EF%BC%9ARL-%E5%BE%AE%E8%B0%83"><span class="toc-text">é˜¶æ®µä¸‰ï¼šRL å¾®è°ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E8%A7%A3%E9%87%8A-2"><span class="toc-text">è¡¥å……è§£é‡Š</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%81%8F%E5%A5%BD%E4%BC%98%E5%8C%96%EF%BC%88Direct-Preference-Optimization%EF%BC%89"><span class="toc-text">ç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDirect Preference Optimizationï¼‰</span></a></li></ol></li></ol></div>
        </div>
      </aside>
    
  </div>
</div>

  </main>

  <!-- é¡µè„šåŒºåŸŸ -->
<footer class="site-footer">
  <div class="footer-inner">
    <!-- é¡µè„šä¿¡æ¯ -->
    <div class="footer-info">
      <p>
        &copy; 2025 - 2026
        <a href="/">ZhenWusi</a>
      </p>
      <p class="footer-powered">
        
          ç”± <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨ |
          ä¸»é¢˜ <a href="/">NINE</a>
        
      </p>
      
    </div>

    <!-- é¡µè„šç¤¾äº¤é“¾æ¥ -->
    <div class="footer-social">
      
      
        
        <a href="https://github.com/ZhenWusi" target="_blank" rel="noopener" title="Github">
          
            <iconify-icon icon="mingcute:github-fill"></iconify-icon>
          
        </a>
      
        
        <a href="https://www.zhihu.com" target="_blank" rel="noopener" title="ZhiHu">
          
            <iconify-icon icon="ri:zhihu-line"></iconify-icon>
          
        </a>
      
        
        <a href="https://twitter.com" target="_blank" rel="noopener" title="Twitter">
          
            <iconify-icon icon="mingcute:social-x-fill"></iconify-icon>
          
        </a>
      
      <a href="/atom.xml" target="_blank" title="RSS è®¢é˜…">
        <i class="fas fa-rss"></i>
      </a>
    </div>
  </div>
</footer>


  <button id="back-to-top" title="å›åˆ°é¡¶éƒ¨">
    <i class="fas fa-chevron-up"></i>
  </button>

  
    <!-- å·¦ä¸‹è§’éŸ³ä¹æ’­æ”¾å™¨ -->

<div class="mini-music-player" id="mini-music-player">
  <!-- éŸ³ä¹æŒ‰é’® -->
  <button class="music-toggle-btn" id="music-toggle-btn" title="éŸ³ä¹æ’­æ”¾å™¨">
    <i class="fas fa-music"></i>
  </button>

  <!-- æ’­æ”¾å™¨é¢æ¿ -->
  <div class="music-panel" id="music-panel">
    <div class="music-content">
      <!-- è‡ªå®šä¹‰æ’­æ”¾å™¨ -->
      <div class="custom-player">
        <div class="player-header">
          <div class="song-info">
            <div class="song-title" id="song-title">åŠ è½½ä¸­...</div>
            <div class="song-artist" id="song-artist">è¯·ç¨å€™</div>
          </div>
          <div class="player-controls">
            <button class="control-btn" id="prev-btn" title="ä¸Šä¸€é¦–">
              <i class="fas fa-step-backward"></i>
            </button>
            <button class="control-btn play-btn" id="play-btn" title="æ’­æ”¾/æš‚åœ">
              <i class="fas fa-play"></i>
            </button>
            <button class="control-btn" id="next-btn" title="ä¸‹ä¸€é¦–">
              <i class="fas fa-step-forward"></i>
            </button>
          </div>
        </div>
        
        <div class="progress-bar">
          <div class="progress-time" id="current-time">0:00</div>
          <div class="progress-track">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <div class="progress-time" id="total-time">0:00</div>
        </div>
        
        <div class="playlist-container">
          <div class="playlist-header">
            <span>æ­Œå•åˆ—è¡¨</span>
            <span class="song-count" id="song-count">0é¦–</span>
          </div>
          <div class="playlist-list" id="playlist-list">
            <!-- æ­Œæ›²åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // éŸ³ä¹æ’­æ”¾å™¨æ§åˆ¶
  const musicToggleBtn = document.getElementById('music-toggle-btn');
  const musicPanel = document.getElementById('music-panel');
  const playBtn = document.getElementById('play-btn');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  const songTitle = document.getElementById('song-title');
  const songArtist = document.getElementById('song-artist');
  const currentTime = document.getElementById('current-time');
  const totalTime = document.getElementById('total-time');
  const progressFill = document.getElementById('progress-fill');
  const playlistList = document.getElementById('playlist-list');
  const songCount = document.getElementById('song-count');
  
  let songs = [];
  let currentSongIndex = 0;
  let isPlaying = false;
  let audioElement = null;
  
  // éŸ³ä¹æ’­æ”¾å™¨çŠ¶æ€ç®¡ç†
  const MUSIC_PLAYER_STATE_KEY = 'musicPlayerState';
  
  // ä¿å­˜æ’­æ”¾å™¨çŠ¶æ€
  function savePlayerState() {
    const state = {
      currentSongIndex: currentSongIndex,
      isPlaying: isPlaying,
      currentTime: audioElement ? audioElement.currentTime : 0,
      panelVisible: musicPanel ? musicPanel.classList.contains('active') : false
    };
    localStorage.setItem(MUSIC_PLAYER_STATE_KEY, JSON.stringify(state));
    console.log('ä¿å­˜æ’­æ”¾å™¨çŠ¶æ€:', state);
  }
  
  // æ¢å¤æ’­æ”¾å™¨çŠ¶æ€
  function restorePlayerState() {
    try {
      const savedState = localStorage.getItem(MUSIC_PLAYER_STATE_KEY);
      if (savedState) {
        const state = JSON.parse(savedState);
        console.log('æ¢å¤æ’­æ”¾å™¨çŠ¶æ€:', state);
        
        // æ¢å¤æ­Œæ›²ç´¢å¼•
        if (state.currentSongIndex !== undefined) {
          currentSongIndex = state.currentSongIndex;
        }
        
        // æ¢å¤æ’­æ”¾çŠ¶æ€
        if (state.isPlaying !== undefined) {
          isPlaying = state.isPlaying;
        }
        
        // æ¢å¤é¢æ¿æ˜¾ç¤ºçŠ¶æ€
        if (state.panelVisible && musicPanel) {
          musicPanel.classList.add('active');
        }
        
        return true;
      }
    } catch (error) {
      console.error('æ¢å¤æ’­æ”¾å™¨çŠ¶æ€å¤±è´¥:', error);
    }
    return false;
  }
  
  // å®šæœŸä¿å­˜çŠ¶æ€
  function setupAutoSave() {
    // æ¯5ç§’ä¿å­˜ä¸€æ¬¡çŠ¶æ€
    setInterval(savePlayerState, 5000);
    
    // é¡µé¢å¸è½½æ—¶ä¿å­˜çŠ¶æ€
    window.addEventListener('beforeunload', savePlayerState);
    
    // é¡µé¢éšè—æ—¶ä¿å­˜çŠ¶æ€
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        savePlayerState();
      }
    });
  }
  
  // åˆ›å»ºéŸ³é¢‘å…ƒç´ 
  function createAudioElement() {
    audioElement = new Audio();
    audioElement.addEventListener('timeupdate', updateProgress);
    audioElement.addEventListener('ended', playNext);
    audioElement.addEventListener('error', handleAudioError);
  }
  
  // å¤„ç†éŸ³é¢‘é”™è¯¯
  function handleAudioError() {
    console.error('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', audioElement.error);
    // å°è¯•ä¸‹ä¸€é¦–
    if (currentSongIndex < songs.length - 1) {
      playNext();
    }
  }
  
  // æ›´æ–°è¿›åº¦
  function updateProgress() {
    if (audioElement && audioElement.duration) {
      const progress = (audioElement.currentTime / audioElement.duration) * 100;
      progressFill.style.width = progress + '%';
      
      currentTime.textContent = formatTime(Math.floor(audioElement.currentTime));
      totalTime.textContent = formatTime(Math.floor(audioElement.duration));
    }
  }
  
  // æ’­æ”¾å½“å‰æ­Œæ›²
  function playCurrentSong() {
    if (songs.length > 0 && songs[currentSongIndex]) {
      const song = songs[currentSongIndex];
      
      if (!audioElement) {
        createAudioElement();
      }
      
      if (song.url) {
        audioElement.src = song.url;
        
        // æ¢å¤æ’­æ”¾ä½ç½®
        const savedState = localStorage.getItem(MUSIC_PLAYER_STATE_KEY);
        if (savedState && isPlaying) {
          const state = JSON.parse(savedState);
          if (state.currentTime > 0) {
            audioElement.currentTime = state.currentTime;
          }
        }
        
        audioElement.play().then(() => {
          isPlaying = true;
          updatePlayButton();
        }).catch(error => {
          console.error('æ’­æ”¾å¤±è´¥:', error);
          // å¦‚æœæ’­æ”¾å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€é¦–
          if (currentSongIndex < songs.length - 1) {
            playNext();
          }
        });
      } else {
        console.error('æ­Œæ›²URLä¸ºç©º:', song);
        // å¦‚æœURLä¸ºç©ºï¼Œå°è¯•ä¸‹ä¸€é¦–
        if (currentSongIndex < songs.length - 1) {
          playNext();
        }
      }
    }
  }
  
  // æ’­æ”¾ä¸‹ä¸€é¦–
  function playNext() {
    if (songs.length > 0) {
      currentSongIndex = (currentSongIndex + 1) % songs.length;
      updateSongInfo();
      updatePlaylist();
      if (isPlaying) {
        playCurrentSong();
      }
    }
  }
  
  // æ’­æ”¾ä¸Šä¸€é¦–
  function playPrev() {
    if (songs.length > 0) {
      currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
      updateSongInfo();
      updatePlaylist();
      if (isPlaying) {
        playCurrentSong();
      }
    }
  }
  
  // æš‚åœæ’­æ”¾
  function pauseCurrentSong() {
    if (audioElement) {
      audioElement.pause();
    }
    isPlaying = false;
    updatePlayButton();
  }
  
  // æ›´æ–°æ’­æ”¾æŒ‰é’®
  function updatePlayButton() {
    const icon = playBtn.querySelector('i');
    if (isPlaying) {
      icon.className = 'fas fa-pause';
      musicToggleBtn.classList.add('playing');
    } else {
      icon.className = 'fas fa-play';
      musicToggleBtn.classList.remove('playing');
    }
  }
  
  // æ›´æ–°æ­Œæ›²ä¿¡æ¯
  function updateSongInfo() {
    if (songs.length > 0 && songs[currentSongIndex]) {
      const song = songs[currentSongIndex];
      songTitle.textContent = song.title;
      songArtist.textContent = song.artist;
    }
  }
  
  // æ›´æ–°æ’­æ”¾åˆ—è¡¨
  function updatePlaylist() {
    playlistList.innerHTML = songs.map((song, index) => `
      <div class="playlist-item ${index === currentSongIndex ? 'active' : ''}" data-index="${index}">
        <div class="song-info">
          <div class="song-name">${song.title}</div>
          <div class="song-artist">${song.artist}</div>
        </div>
      </div>
    `).join('');
    
    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
    document.querySelectorAll('.playlist-item').forEach(item => {
      item.addEventListener('click', function() {
        currentSongIndex = parseInt(this.dataset.index);
        updateSongInfo();
        updatePlaylist();
        if (isPlaying) {
          playCurrentSong();
        }
      });
    });
  }
  
  // è·å–ç½‘æ˜“äº‘æ­Œå•æ•°æ®
  async function fetchPlaylist() {
    try {
      console.log('æ­£åœ¨è·å–æ­Œå•æ•°æ®...');
      // ä»é…ç½®æ–‡ä»¶ä¸­è·å–æ­Œå• ID
      const playlistId = '2993057618';
      console.log('ä½¿ç”¨æ­Œå• ID:', playlistId);
      
      const response = await fetch(`https://api.injahow.cn/meting/?type=playlist&id=${playlistId}`);
      const data = await response.json();
      
      console.log('æ­Œå•æ•°æ®:', data);
      
      if (data && data.length > 0) {
        songs = data.map(song => ({
          title: song.name || song.title,
          artist: song.artist || song.ar?.[0]?.name || 'æœªçŸ¥è‰ºæœ¯å®¶',
          url: song.url,
          pic: song.pic
        }));
        
        updatePlaylist();
        updateSongInfo();
        songCount.textContent = `${songs.length}é¦–`;
      }
    } catch (error) {
      console.error('è·å–æ­Œå•å¤±è´¥:', error);
      // ä½¿ç”¨å¤‡ç”¨æ•°æ®
      songs = [
        { title: "åŠ è½½å¤±è´¥", artist: "è¯·æ£€æŸ¥ç½‘ç»œ", url: "", pic: "" }
      ];
      updatePlaylist();
      updateSongInfo();
    }
  }
  
  // åˆ‡æ¢éŸ³ä¹é¢æ¿
  if (musicToggleBtn && musicPanel) {
    musicToggleBtn.addEventListener('click', function() {
      console.log('éŸ³ä¹æŒ‰é’®è¢«ç‚¹å‡»');
      musicPanel.classList.toggle('active');
      if (songs.length === 0) {
        fetchPlaylist().then(() => {
          // æ­Œå•åŠ è½½å®Œæˆåï¼Œå¦‚æœæœ‰ä¿å­˜çš„çŠ¶æ€ï¼Œæ¢å¤æ’­æ”¾
          const stateRestored = restorePlayerState();
          if (stateRestored && songs.length > 0) {
            updateSongInfo();
            updatePlaylist();
            if (isPlaying) {
              playCurrentSong();
            }
          }
        });
      }
      savePlayerState(); // ä¿å­˜é¢æ¿çŠ¶æ€
    });
  }
  
  // ç‚¹å‡»é¢æ¿å¤–éƒ¨å…³é—­
  document.addEventListener('click', function(e) {
    if (musicPanel && !musicPanel.contains(e.target) && !musicToggleBtn.contains(e.target)) {
      musicPanel.classList.remove('active');
    }
  });
  
  // æ’­æ”¾æ§åˆ¶
  if (playBtn) {
    playBtn.addEventListener('click', function() {
      if (isPlaying) {
        pauseCurrentSong();
      } else {
        playCurrentSong();
      }
    });
  }
  
  if (prevBtn) {
    prevBtn.addEventListener('click', function() {
      playPrev();
    });
  }
  
  if (nextBtn) {
    nextBtn.addEventListener('click', function() {
      playNext();
    });
  }
  
  // é¡µé¢åˆå§‹åŒ–æ—¶æ¢å¤çŠ¶æ€
  document.addEventListener('DOMContentLoaded', function() {
    console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–éŸ³ä¹æ’­æ”¾å™¨');
    
    // å°è¯•æ¢å¤ä¿å­˜çš„çŠ¶æ€
    const stateRestored = restorePlayerState();
    
    // å¦‚æœæœ‰ä¿å­˜çš„çŠ¶æ€ï¼Œå…ˆåŠ è½½æ­Œå•ç„¶åæ¢å¤æ’­æ”¾
    if (stateRestored) {
      fetchPlaylist().then(() => {
        if (songs.length > 0) {
          updateSongInfo();
          updatePlaylist();
          if (isPlaying) {
            playCurrentSong();
          }
        }
      });
    }
    
    // è®¾ç½®è‡ªåŠ¨ä¿å­˜
    setupAutoSave();
  });
  
  function formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${minutes}:${secs.toString().padStart(2, '0')}`;
  }
</script>

<style>
  .mini-music-player {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 1000;
  }
  
  .music-toggle-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #4f46e5, #3730a3);
    color: #fff;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }
  
  .music-toggle-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(79, 70, 229, 0.4);
  }
  
  .music-toggle-btn.playing {
    animation: musicPulse 2s infinite;
  }
  
  .music-panel {
    position: absolute;
    bottom: 60px;
    left: 0;
    width: 320px;
    max-height: 450px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
    transition: all 0.3s ease;
    overflow: hidden;
  }
  
  .music-panel.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  .custom-player {
    padding: 16px;
  }
  
  .player-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
  }
  
  .song-info {
    flex: 1;
    min-width: 0;
  }
  
  .song-title {
    font-size: 0.9rem;
    font-weight: 600;
    color: #333;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 2px;
  }
  
  .song-artist {
    font-size: 0.8rem;
    color: #666;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .player-controls {
    display: flex;
    gap: 8px;
  }
  
  .control-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, #4f46e5, #3730a3);
    color: #fff;
    border: none;
    cursor: pointer;
    font-size: 0.8rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .control-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
  }
  
  .progress-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
    padding: 8px 0;
  }
  
  .progress-time {
    font-size: 0.7rem;
    color: #666;
    min-width: 30px;
    text-align: center;
  }
  
  .progress-track {
    flex: 1;
    height: 4px;
    background: #e9ecef;
    border-radius: 2px;
    overflow: hidden;
    position: relative;
  }
  
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4f46e5, #3730a3);
    border-radius: 2px;
    width: 0%;
    transition: width 0.3s ease;
  }
  
  .playlist-container {
    max-height: 200px;
    overflow-y: auto;
    background: #fff;
  }
  
  .playlist-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: #f8f9fa;
    font-size: 0.8rem;
    font-weight: 600;
    color: #333;
    border-bottom: 1px solid #e9ecef;
  }
  
  .song-count {
    color: #666;
    font-size: 0.7rem;
  }
  
  .playlist-list {
    max-height: 180px;
    overflow-y: auto;
  }
  
  .playlist-item {
    padding: 8px 12px;
    border-bottom: 1px solid #f0f0f0;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .playlist-item:hover {
    background: #f8f9fa;
  }
  
  .playlist-item.active {
    background: linear-gradient(135deg, #4f46e5, #3730a3);
    color: #fff;
  }
  
  .playlist-item .song-name {
    font-size: 0.8rem;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .playlist-item .song-artist {
    font-size: 0.7rem;
    opacity: 0.7;
    margin-top: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .playlist-item.active .song-artist {
    opacity: 0.9;
  }
  
  @keyframes musicPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }
  
  @media (prefers-color-scheme: dark) {
    .music-panel {
      background: rgba(30, 30, 30, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .progress-bar {
      background: #2d2d2d;
      color: #ccc;
    }
    
    .playlist-header {
      background: #2d2d2d;
      color: #fff;
      border-bottom-color: #404040;
    }
    
    .playlist-item {
      border-bottom-color: #404040;
      color: #fff;
    }
    
    .playlist-item:hover {
      background: #3d3d3d;
    }
  }
  
  @media (max-width: 768px) {
    .mini-music-player {
      bottom: 16px;
      left: 16px;
    }
    
    .music-panel {
      width: 300px;
      max-height: 400px;
    }
    
    .music-toggle-btn {
      width: 36px;
      height: 36px;
      font-size: 0.8rem;
    }
  }
</style>


  

  
<script src="/js/main.js"></script>


  <!-- æ–¹å¼ Bï¼šKaTeX CDN å®¢æˆ·ç«¯è‡ªåŠ¨æ¸²æŸ“ -->
  

  <!-- æ–¹å¼ Cï¼šMathJax v3 CDNï¼ˆå« findScriptï¼Œå…¼å®¹ hexo-renderer-mathjax è¾“å‡ºï¼‰ -->
  
    
<script>
  // ç¦ç”¨ hexo-renderer-mathjax çš„è‡ªåŠ¨é…ç½®
  if (typeof window.MathJax === 'undefined') {
    (function () {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          tags: 'ams',
          processEscapes: true,
          packages: ['base', 'ams', 'amssymb', 'newcommand']
        },
        chtml: { 
          scale: 1.05,
          overflow: 'visible'
        },
        options: {
          enableMenu: false,
          processEscapes: true,
          processEnvironments: true,
          renderActions: {
            findScript: [10, function (doc) {
              var nodes = document.querySelectorAll('script[type^="math/tex"]');
              for (var i = 0; i < nodes.length; i++) {
                var node = nodes[i];
                var display = !!node.type.match(/; *mode=display/);
                var math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                var text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              }
            }, '']
          }
        }
      };
      var s = document.createElement('script');
      s.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      s.id = 'MathJax-script';
      s.async = true;
      document.head.appendChild(s);
    })();
  }
  
  // ç§»é™¤æ‰€æœ‰è¿‡æ—¶çš„ MathJax v2 é…ç½®
  document.addEventListener('DOMContentLoaded', function() {
    // ç§»é™¤ x-mathjax-config è„šæœ¬æ ‡ç­¾
    const oldConfigs = document.querySelectorAll('script[type="text/x-mathjax-config"]');
    oldConfigs.forEach(config => config.remove());
    
    // ç§»é™¤è¿‡æ—¶çš„ MathJax.Hub è„šæœ¬
    const oldScripts = document.querySelectorAll('script[src*="MathJax.js"]');
    oldScripts.forEach(script => {
      if (!script.id || script.id !== 'MathJax-script') {
        script.remove();
      }
    });
  });
</script>

  
</body>
</html>
